{"ast":null,"code":"export default function (req, res) {\n  if (req.method !== \"POST\") {\n    return res.status(405).end();\n  }\n\n  const {\n    laanebelop,\n    nominellRente,\n    terminGebyr,\n    utlopsDato,\n    saldoDato,\n    datoForsteInnbetaling,\n    ukjentVerdi\n  } = req.body;\n  var h = {\n    nedbetalingsplan: {\n      nedbetalinger: [{\n        restgjeld: laanebelop,\n        dato: saldoDato,\n        innbetaling: 0.0,\n        gebyr: 0.0,\n        renter: 0.0,\n        total: 0.0\n      }]\n    }\n  };\n  const datoDiff = monthsDiff(datoForsteInnbetaling, utlopsDato);\n  var restgjeld = laanebelop;\n  var rente = laanebelop * (nominellRente / 100 / datoDiff);\n  var dato = new Date(datoForsteInnbetaling);\n  var td = nominellRente / 100 / datoDiff / (1 - Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff)) * laaneBelop;\n\n  for (i = 0; i <= datoDiff; i++) {\n    rente = restgjeld * (nominellRente / 100 / datoDiff);\n    var avdrag = td - rente;\n    restgjeld -= avdrag;\n    nedbetalingsplan.nedbetalinger.push({\n      restgjeld: Math.round(restgjeld),\n      dato: dato.toISOString().substring(0, 10),\n      innbetaling: Math.round(avdrag),\n      gebyr: terminGebyr,\n      renter: Math.round(rente),\n      total: Math.round(nominellRente / 100 / datoDiff / (1 - Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff)) * laaneBelop + terminGebyr)\n    });\n    console.log(Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff));\n    console.log(1 - Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff));\n    dato.setMonth(dato.getMonth() + 1, 1);\n  }\n\n  h.nedbetalingsplan.nedbetalinger.pop();\n  res.status(200).json(h);\n}\n\nfunction yearsDiff(d1, d2) {\n  let date1 = new Date(d1);\n  let date2 = new Date(d2);\n  let yearsDiff = date2.getFullYear() - date1.getFullYear();\n  return yearsDiff;\n}\n\nfunction monthsDiff(d1, d2) {\n  let date1 = new Date(d1);\n  let date2 = new Date(d2);\n  let years = yearsDiff(d1, d2);\n  let months = years * 12 + (date2.getMonth() - date1.getMonth());\n  return months;\n}","map":{"version":3,"sources":["D:/git/nextjs/pages/api/Annuitetslaan.js"],"names":["req","res","method","status","end","laanebelop","nominellRente","terminGebyr","utlopsDato","saldoDato","datoForsteInnbetaling","ukjentVerdi","body","h","nedbetalingsplan","nedbetalinger","restgjeld","dato","innbetaling","gebyr","renter","total","datoDiff","monthsDiff","rente","Date","td","Math","pow","laaneBelop","i","avdrag","push","round","toISOString","substring","console","log","setMonth","getMonth","pop","json","yearsDiff","d1","d2","date1","date2","getFullYear","years","months"],"mappings":"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","sourcesContent":["export default function (req, res) {\r\n  if (req.method !== \"POST\") {\r\n    return res.status(405).end();\r\n  }\r\n  const {\r\n    laanebelop,\r\n    nominellRente,\r\n    terminGebyr,\r\n    utlopsDato,\r\n    saldoDato,\r\n    datoForsteInnbetaling,\r\n    ukjentVerdi,\r\n  } = req.body;\r\n\r\n  var h = {\r\n    nedbetalingsplan: {\r\n      nedbetalinger: [\r\n        {\r\n          restgjeld: laanebelop,\r\n          dato: saldoDato,\r\n          innbetaling: 0.0,\r\n          gebyr: 0.0,\r\n          renter: 0.0,\r\n          total: 0.0,\r\n        },\r\n      ],\r\n    },\r\n  };\r\n  const datoDiff = monthsDiff(datoForsteInnbetaling, utlopsDato);\r\n  var restgjeld = laanebelop;\r\n  var rente = laanebelop * (nominellRente / 100 / datoDiff);\r\n  var dato = new Date(datoForsteInnbetaling);\r\n  var td =\r\n    (nominellRente /\r\n      100 /\r\n      datoDiff /\r\n      (1 - Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff))) *\r\n    laaneBelop;\r\n  for (i = 0; i <= datoDiff; i++) {\r\n    rente = restgjeld * (nominellRente / 100 / datoDiff);\r\n    var avdrag = td - rente;\r\n    restgjeld -= avdrag;\r\n    nedbetalingsplan.nedbetalinger.push({\r\n      restgjeld: Math.round(restgjeld),\r\n      dato: dato.toISOString().substring(0, 10),\r\n      innbetaling: Math.round(avdrag),\r\n      gebyr: terminGebyr,\r\n      renter: Math.round(rente),\r\n      total: Math.round(\r\n        (nominellRente /\r\n          100 /\r\n          datoDiff /\r\n          (1 - Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff))) *\r\n          laaneBelop +\r\n          terminGebyr\r\n      ),\r\n    });\r\n    console.log(Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff));\r\n    console.log(1 - Math.pow(1 + nominellRente / 100 / datoDiff, -datoDiff));\r\n    dato.setMonth(dato.getMonth() + 1, 1);\r\n  }\r\n  h.nedbetalingsplan.nedbetalinger.pop();\r\n  res.status(200).json(h);\r\n}\r\n\r\nfunction yearsDiff(d1, d2) {\r\n  let date1 = new Date(d1);\r\n  let date2 = new Date(d2);\r\n  let yearsDiff = date2.getFullYear() - date1.getFullYear();\r\n  return yearsDiff;\r\n}\r\n\r\nfunction monthsDiff(d1, d2) {\r\n  let date1 = new Date(d1);\r\n  let date2 = new Date(d2);\r\n  let years = yearsDiff(d1, d2);\r\n  let months = years * 12 + (date2.getMonth() - date1.getMonth());\r\n  return months;\r\n}\r\n"]},"metadata":{},"sourceType":"module"}